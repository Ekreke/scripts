# OpenVPN Docker 自动化部署脚本

这个脚本用于自动化部署 OpenVPN Access Server 服务器，使用 Docker 容器运行。

## 功能特性

- 自动拉取 OpenVPN Access Server Docker 镜像
- 创建数据持久化目录
- 自动配置容器运行参数
- 数据卷挂载，保证配置持久化

## 端口配置

脚本使用以下端口映射：

- **943** - Web 管理界面端口
- **443** - HTTPS VPN 连接端口
- **1194/udp** - UDP VPN 连接端口

> **注意**：脚本会检测端口占用情况，如果端口已被使用会给出提示。

## 快速开始

### 1. 下载并运行脚本

```bash
# 确保脚本有执行权限
chmod +x setup-openvpn.sh

# 运行安装脚本
./setup-openvpn.sh
```

### 2. 访问管理界面

脚本运行完成后，可以通过以下地址访问：

- **管理界面**: https://localhost:943/admin
- **用户界面**: https://localhost:943

> **重要提醒**:
> - 请务必使用 HTTPS 协议访问
> - 如果没有绑定 SSL 证书，浏览器会提示安全风险，请接受风险继续访问

## 数据持久化

脚本会在以下位置创建数据目录：

```bash
# 相对路径
~/./var/open-vpn-data

# 脚本会自动获取并显示绝对路径
```

所有 OpenVPN 配置文件、用户数据和日志都会保存在这个目录中，即使容器重启或重新创建也不会丢失。

## 系统要求

- Docker 已安装并运行
- 有权限访问 `/dev/net/tun` 设备
- 足够的系统权限运行 Docker 容器

## 脚本执行流程

1. **拉取镜像**: 下载最新的 OpenVPN Access Server 镜像
2. **创建目录**: 在用户目录下创建数据持久化目录
3. **清理容器**: 停止并删除已存在的同名容器（如果有）
4. **启动容器**: 使用配置好的参数运行新容器
5. **显示信息**: 输出访问地址和数据目录路径

## 故障排除

### 端口占用问题
如果提示端口被占用，可以：
- 停止占用端口的其他服务
- 修改脚本中的端口映射


## 首次使用配置

1. 访问 https://localhost:943/admin
2. 使用默认管理员账户登录（默认初始账号是 `openvpn`，密码在log日志中 可以通过 docker log 查看容器日志）
3. 设置管理员密码
4. 配置 VPN 网络设置
5. 创建用户账户

## 安全建议

- 生产环境中建议绑定自定义 SSL 证书
- 定期备份数据目录 `~/./var/open-vpn-data`
- 设置强密码策略
- 定期更新 OpenVPN 镜像